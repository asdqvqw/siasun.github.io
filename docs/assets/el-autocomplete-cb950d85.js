import{bL as he,bP as z,dt as me,cV as T,c0 as B,e8 as D,cW as Q,c6 as be,d as j,dg as ye,bm as Ee,cZ as we,bN as $e,aV as p,Q as b,dx as Se,aK as Ae,o as A,e as ke,f,a as Z,aC as k,bl as t,n as x,b as N,c as F,bQ as Ne,dV as Te,F as Ce,aY as Ie,aZ as y,m as Ve,bc as _e,E as Be,aA as Fe,w as E,bJ as G,$ as Pe,bO as De,aB as Oe,cL as P,bZ as Ke,bR as Me}from"./index-07ba0ec2.js";import{E as Re}from"./el-scrollbar-4234c05b.js";import{u as Le,E as We}from"./el-popper-3468e961.js";import{d as Ue}from"./debounce-b1d69dcc.js";const He=()=>Math.floor(Math.random()*1e4),qe=he({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:z(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:z([Function,Array]),default:me},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:Le.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1}}),ze={[T]:o=>B(o),[D]:o=>B(o),[Q]:o=>B(o),focus:o=>o instanceof FocusEvent,blur:o=>o instanceof FocusEvent,clear:()=>!0,select:o=>be(o)},Ze=["aria-expanded","aria-owns"],xe={key:0},Ge=["id","aria-selected","onClick"],J="ElAutocomplete",Qe=j({name:J,inheritAttrs:!1}),je=j({...Qe,props:qe,emits:ze,setup(o,{expose:Y,emit:u}){const l=o,X=ye(),ee=Ee(),te=we(),i=$e("autocomplete"),n=p(),O=p(),K=p(),M=p();let R=!1,w=!1;const c=p([]),s=p(-1),L=p(""),d=p(!1),$=p(!1),g=p(!1),m=b(()=>i.b(String(He()))),ae=b(()=>ee.style),v=b(()=>(c.value.length>0||g.value)&&d.value),W=b(()=>!l.hideLoading&&g.value),se=b(()=>n.value?Array.from(n.value.$el.querySelectorAll("input")):[]),oe=async()=>{await Oe(),v.value&&(L.value=`${n.value.$el.offsetWidth}px`)},le=()=>{w=!0},ne=()=>{w=!1,s.value=-1},U=Ue(async e=>{if($.value)return;const a=r=>{g.value=!1,!$.value&&(P(r)?(c.value=r,s.value=l.highlightFirstItem?0:-1):Ke(J,"autocomplete suggestions must be an array"))};if(g.value=!0,P(l.fetchSuggestions))a(l.fetchSuggestions);else{const r=await l.fetchSuggestions(e,a);P(r)&&a(r)}},l.debounce),re=e=>{const a=!!e;if(u(D,e),u(T,e),$.value=!1,d.value||(d.value=a),!l.triggerOnFocus&&!e){$.value=!0,c.value=[];return}U(e)},ue=e=>{var a;te.value||(((a=e.target)==null?void 0:a.tagName)!=="INPUT"||se.value.includes(document.activeElement))&&(d.value=!0)},ie=e=>{u(Q,e)},ce=e=>{w||(d.value=!0,u("focus",e),l.triggerOnFocus&&!R&&U(String(l.modelValue)))},pe=e=>{w||u("blur",e)},de=()=>{d.value=!1,u(T,""),u("clear")},H=async()=>{v.value&&s.value>=0&&s.value<c.value.length?C(c.value[s.value]):l.selectWhenUnmatched&&(u("select",{value:l.modelValue}),c.value=[],s.value=-1)},fe=e=>{v.value&&(e.preventDefault(),e.stopPropagation(),S())},S=()=>{d.value=!1},ve=()=>{var e;(e=n.value)==null||e.focus()},ge=()=>{var e;(e=n.value)==null||e.blur()},C=async e=>{u(D,e[l.valueKey]),u(T,e[l.valueKey]),u("select",e),c.value=[],s.value=-1},I=e=>{if(!v.value||g.value)return;if(e<0){s.value=-1;return}e>=c.value.length&&(e=c.value.length-1);const a=O.value.querySelector(`.${i.be("suggestion","wrap")}`),h=a.querySelectorAll(`.${i.be("suggestion","list")} li`)[e],V=a.scrollTop,{offsetTop:q,scrollHeight:_}=h;q+_>V+a.clientHeight&&(a.scrollTop+=_),q<V&&(a.scrollTop-=_),s.value=e,n.value.ref.setAttribute("aria-activedescendant",`${m.value}-item-${s.value}`)};return Se(M,()=>{v.value&&S()}),Ae(()=>{n.value.ref.setAttribute("role","textbox"),n.value.ref.setAttribute("aria-autocomplete","list"),n.value.ref.setAttribute("aria-controls","id"),n.value.ref.setAttribute("aria-activedescendant",`${m.value}-item-${s.value}`),R=n.value.ref.hasAttribute("readonly")}),Y({highlightedIndex:s,activated:d,loading:g,inputRef:n,popperRef:K,suggestions:c,handleSelect:C,handleKeyEnter:H,focus:ve,blur:ge,close:S,highlight:I}),(e,a)=>(A(),ke(t(We),{ref_key:"popperRef",ref:K,visible:t(v),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(i).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(i).namespace.value}-zoom-in-top`,persistent:"",onBeforeShow:oe,onShow:le,onHide:ne},{content:f(()=>[Z("div",{ref_key:"regionRef",ref:O,class:k([t(i).b("suggestion"),t(i).is("loading",t(W))]),style:x({[e.fitInputWidth?"width":"minWidth"]:L.value,outline:"none"}),role:"region"},[N(t(Re),{id:t(m),tag:"ul","wrap-class":t(i).be("suggestion","wrap"),"view-class":t(i).be("suggestion","list"),role:"listbox"},{default:f(()=>[t(W)?(A(),F("li",xe,[N(t(Ne),{class:k(t(i).is("loading"))},{default:f(()=>[N(t(Te))]),_:1},8,["class"])])):(A(!0),F(Ce,{key:1},Ie(c.value,(r,h)=>(A(),F("li",{id:`${t(m)}-item-${h}`,key:h,class:k({highlighted:s.value===h}),role:"option","aria-selected":s.value===h,onClick:V=>C(r)},[y(e.$slots,"default",{item:r},()=>[Ve(_e(r[e.valueKey]),1)])],10,Ge))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:f(()=>[Z("div",{ref_key:"listboxRef",ref:M,class:k([t(i).b(),e.$attrs.class]),style:x(t(ae)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(v),"aria-owns":t(m)},[N(t(Be),Fe({ref_key:"inputRef",ref:n},t(X),{"model-value":e.modelValue,onInput:re,onChange:ie,onFocus:ce,onBlur:pe,onClear:de,onKeydown:[a[0]||(a[0]=E(G(r=>I(s.value-1),["prevent"]),["up"])),a[1]||(a[1]=E(G(r=>I(s.value+1),["prevent"]),["down"])),E(H,["enter"]),E(S,["tab"]),E(fe,["esc"])],onMousedown:ue}),Pe({_:2},[e.$slots.prepend?{name:"prepend",fn:f(()=>[y(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:f(()=>[y(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:f(()=>[y(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:f(()=>[y(e.$slots,"suffix")])}:void 0]),1040,["model-value","onKeydown"])],14,Ze)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Je=De(je,[["__file","/home/runner/work/element-plus/element-plus/packages/components/autocomplete/src/autocomplete.vue"]]);const st=Me(Je);export{st as E};
