import{o as F,c as D,bH as E,by as I,bl as e,a as t,aC as ye,F as O,aV as y,b as h,f as $,m as l,bc as n,l as Q,n as He,g as Qe,aK as Me,_ as Ve,p as Se,q as Ie,at as Ue,bx as We,cj as K}from"./index-30f3269e.js";import{D as G,b as Ze,S as Ke,P as et,W as tt,G as lt,A as ue,V as J,M as X,L as $e,B as Ce,a as ke,E as ee,Q as te,c as q,d as nt}from"./three.module-2fa5ea98.js";import{G as ot,D as at,O as st}from"./DRACOLoader-49781d31.js";import{i as M,s as S,p as k,c as R,a,b as i,d as Te,e as re,N as it,f as ut,g as rt,h as Fe,j as _t,k as ct,l as dt,m as mt,n as ft,o as vt,q as pt,r as ht,t as bt,u as le,v as gt,w as xt,x as wt,y as yt,z as De,A as Le,B as $t,C as Ct,D as kt,E as Et,F as Mt,G as Vt,H as St,I as It,J as Tt,K as Ft,L as Dt,M as Lt,O as Ne,P as Nt,Q as Jt,R as qt,S as Ee,T as At,U as Ot,V as Rt,W as Pt,X as Bt,Y as Gt,Z as Xt,_ as jt,$ as j,a0 as Yt,a1 as z,a2 as H,a3 as ne,a4 as zt}from"./bbb_Aqw.vue_vue_type_style_index_0_lang-630961c8.js";import{E as P}from"./el-dialog-37411be4.js";import{i as Je}from"./index-0f4036db.js";const Ht=["disabled","title"],Qt=["disabled","title"],Ut=["disabled"],Wt={__name:"contorl",setup(x){const r=()=>{R.value=!R.value,R.value?controls.enabled=!1:controls.enabled=!0},c=()=>{a.value=0,i.value=[],i.value=Te.concat()},p=()=>{k.value=!k.value},g=()=>{if(S.value){const m=i.value[a.value].logJson.event.name;for(;i.value[a.value].logJson.event.name===m&&!(a.value===i.value.length-1||a.value===0);)a.value++;re.value=1,S.value=!1}};return(m,o)=>(F(),D(O,null,[E(t("div",null,[t("button",{disabled:e(S),onClick:p,class:ye({playbuttonstyle:e(k),stopbuttonstyle:!e(k)}),title:e(k)?"播放":e(S)?"请处理事件":"暂停"},null,10,Ht)],512),[[I,!e(M)]]),E(t("div",null,[t("button",{disabled:!e(S),onClick:g,class:"eventbuttonstyle",title:e(S)?"事件跳过":"无事件"},null,8,Qt)],512),[[I,!e(M)]]),E(t("div",null,[t("button",{disabled:e(S),onClick:c,class:"replaybuttonstyle",title:"重播"},null,8,Ut)],512),[[I,!e(M)]]),E(t("div",null,[t("button",{onClick:r,class:ye({genbuttonstyle:e(R),bugenbuttonstyle:!e(R)}),title:"镜头跟随"},null,2)],512),[[I,!e(M)]])],64))}};const Zt=t("br",null,null,-1),Kt=t("br",null,null,-1),el=t("br",null,null,-1),tl=t("br",null,null,-1),ll=t("br",null,null,-1),nl=t("br",null,null,-1),ol=t("br",null,null,-1),al=t("br",null,null,-1),sl=t("br",null,null,-1),il=t("br",null,null,-1),ul=t("br",null,null,-1),rl=t("br",null,null,-1),_l=t("br",null,null,-1),cl={__name:"Contral_Net",setup(x){const r=y(!1),c=()=>{r.value=!0};return(p,g)=>{const m=Q,o=P;return F(),D(O,null,[E(h(m,{class:"EXButton",onClick:c},{default:$(()=>[l("控制台")]),_:1},512),[[I,!e(M)]]),h(o,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=d=>r.value=d),title:"控制台","custom-class":"custom-dialog"},{default:$(()=>[l(" 开始节点："+n(e(it)),1),Zt,l(" 目标节点："+n(e(ut)),1),Kt,l(" 当前进度量："+n(e(rt)),1),el,l(" 当前设置速度："+n(e(Fe)),1),tl,l(" 货物状态："+n(e(_t)),1),ll,l(" 工作状态："+n(e(ct)),1),nl,l(" 1级故障码:"+n(e(dt)),1),ol,l(" 2级故障码:"+n(e(mt)),1),al,l(" 电池状态："+n(e(ft)),1),sl,l(" 任务状态："+n(e(vt)),1),il,l(" 任务号："+n(e(pt)),1),ul,l(" 动作key："+n(e(ht)),1),rl,l(" heading:"+n(e(bt)),1),_l]),_:1},8,["modelValue"])],64)}}};const dl=t("br",null,null,-1),ml=t("br",null,null,-1),fl=t("br",null,null,-1),vl=t("br",null,null,-1),pl=t("br",null,null,-1),hl=t("br",null,null,-1),bl=t("br",null,null,-1),gl=t("br",null,null,-1),xl={__name:"Info_box",setup(x){let r="AGV状态";return(c,p)=>e(le)?(F(),D("div",{key:0,class:"info-text",style:He({left:e(De)+"px",top:e(Le)+"px"})},[l(n(e(r)),1),dl,l(" 时间："+n(e(i)[e(a)].logDateTime),1),ml,l(" 车体软件版本："+n(),1),fl,l(" 车号："+n(),1),vl,l(" 模式："+n(e(gt)),1),pl,l(" 事件："+n(e(xt)),1),hl,l(" 原因："+n(e(wt)),1),bl,l(" 建议："+n(e(yt)),1),gl],4)):Qe("",!0)}};const wl=t("br",null,null,-1),yl=t("br",null,null,-1),$l=t("br",null,null,-1),Cl=t("br",null,null,-1),kl=t("br",null,null,-1),El=t("br",null,null,-1),Ml=t("br",null,null,-1),Vl=t("br",null,null,-1),Sl=t("br",null,null,-1),Il=t("br",null,null,-1),Tl=t("br",null,null,-1),Fl=t("br",null,null,-1),Dl=t("br",null,null,-1),Ll=t("br",null,null,-1),Nl={__name:"AGV_device",setup(x){const r=y(!1),c=()=>{r.value=!0};return(p,g)=>{const m=Q,o=P;return F(),D(O,null,[E(h(m,{class:"EXButtonDEV",onClick:c},{default:$(()=>[l("车体设备")]),_:1},512),[[I,!e(M)]]),h(o,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=d=>r.value=d),title:"车体设备","custom-class":"custom-dialog"},{default:$(()=>[l(" 转盘纵向开关："+n(e(i)[e(a)].logJson.equipmentInfo.rack.turn_axis.bZero?"触发":"未触发"),1),wl,l(" 转盘横向开关："+n(e(i)[e(a)].logJson.equipmentInfo.rack.turn_axis.bLevel?"触发":"未触发"),1),yl,l(" 转盘位置:"+n(e(i)[e(a)].trunpan.toFixed(3)),1),$l,l(" 举升高位开关："+n(e(i)[e(a)].logJson.equipmentInfo.rack.lifter_axis.bTop?"触发":"未触发"),1),Cl,l(" 举升零位开关："+n(e(i)[e(a)].logJson.equipmentInfo.rack.lifter_axis.bBottom?"触发":"未触发"),1),kl,l(" 举升位置："+n(e(i)[e(a)].lifter.toFixed(3)),1),El,l(" 当前设备状态："+n(e($t)),1),Ml,l(" 当前设备任务号："+n(e(Ct)),1),Vl,l(" 当前设备任务状态："+n(e(kt)),1),Sl,l(" 当前设备故障码:  "+n(e(Et)),1),Il,l(" 当前设备动作步骤: "+n(e(Mt)),1),Tl,l(" 当前动作轴id: "+n(),1),Fl,l(" 当前动作轴位置: "+n(),1),Dl,l(" 当前动作轴开关状态: "+n(),1),Ll]),_:1},8,["modelValue"])],64)}}};const Jl=t("br",null,null,-1),ql=t("br",null,null,-1),Al=t("br",null,null,-1),Ol=t("br",null,null,-1),Rl=t("br",null,null,-1),Pl=t("br",null,null,-1),Bl=t("br",null,null,-1),Gl=t("br",null,null,-1),Xl=t("br",null,null,-1),jl=t("div",{class:"bingzhuang",id:"main1",style:{width:"300px",height:"300px"}},null,-1),Yl={__name:"AGV_Nav",setup(x){const r=y(!1),c=()=>{r.value=!0},p=()=>{const g=document.getElementById("main1"),m=Je(g),o=[{value:Math.round(Math.random()*1e3),name:"占用一"},{value:Math.round(Math.random()*1e3),name:"占用二"},{value:Math.round(Math.random()*1e3),name:"占用三"},{value:Math.round(Math.random()*1e3),name:"占用四"},{value:Math.round(Math.random()*1e3),name:"占用五"}],d={title:{text:"占用",textStyle:{color:"black"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:10,data:o.map(b=>b.name)},series:[{name:"测试数据",type:"pie",radius:"50%",center:["50%","50%"],data:o,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};setInterval(()=>{o.forEach(b=>{b.value=Math.round(Math.random()*1e3)}),m.setOption({series:[{data:o}]})},1e3),m.setOption(d)};return(g,m)=>{const o=Q,d=P;return F(),D(O,null,[E(h(o,{class:"EXButtonNAV",onClick:c},{default:$(()=>[l("导航")]),_:1},512),[[I,!e(M)]]),h(d,{modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=b=>r.value=b),title:"导航","custom-class":"custom-dialog",onOpened:p},{default:$(()=>[l(" 目标位置:"+n(e(Vt))+" ",1),Jl,l(" 当前位置："+n(e(St)),1),ql,l(" 理论位置："+n(e(It)),1),Al,l(" 左右偏差："+n(e(Tt)),1),Ol,l(" 角度偏差："+n((e(Ft)*180/Math.PI).toFixed(3)),1),Rl,l(" 导航软件版本："+n(e(Dt)),1),Pl,l(" 导航环境模型版本："+n(e(Lt)),1),Bl,l(" 发送速度："+n(),1),Gl,l(" 发送舵角："+n(),1),Xl,jl]),_:1},8,["modelValue"])],64)}}},qe={__name:"Ele_chart",setup(x){const r=y(null),c=(()=>{let o=new Date,d=[],b=5;for(;b--;)d.unshift(o.toLocaleTimeString().replace(/^\D*/,"")),o=new Date(+o-500);return d})(),p=(()=>{let o=[],d=5;for(;d--;)o.push(Math.round(Math.random()*1e3));return o})(),g=(()=>{let o=[],d=5;for(;d--;)o.push(Math.round(Math.random()*1e3));return o})();let m={title:{text:"车速",textStyle:{color:"white"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{},toolbox:{show:!0,feature:{dataView:{readOnly:!1},magicType:{type:["bar","line","stack"]},restore:{},saveAsImage:{}},bottom:10},xAxis:{type:"category",data:c,boundaryGap:!0},yAxis:{type:"value"},series:[{data:p,type:"line",name:"实际",color:"green",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{data:g,name:"理论",type:"line",color:"yellow",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};return Me(()=>{const o=Je(r.value);setInterval(()=>{let d=(Ne.value*1e3).toFixed(2),b=new Date().toLocaleTimeString().replace(/^\D*/,"");c.shift(),c.push(b),p.shift(),p.push(d),g.shift(),g.push(Fe.value),o.setOption({xAxis:[{data:c}],series:[{data:p},{data:g}]})},400),o.setOption(m)}),(o,d)=>(F(),D("div",{class:"chart",id:"main2",style:{width:700+"px",height:300+"px"},ref_key:"main2",ref:r},null,512))}};const v=x=>(Se("data-v-99fbd68b"),x=x(),Ie(),x),zl=v(()=>t("br",null,null,-1)),Hl=v(()=>t("br",null,null,-1)),Ql=v(()=>t("br",null,null,-1)),Ul=v(()=>t("br",null,null,-1)),Wl=v(()=>t("br",null,null,-1)),Zl=v(()=>t("br",null,null,-1)),Kl=v(()=>t("br",null,null,-1)),en=v(()=>t("br",null,null,-1)),tn=v(()=>t("br",null,null,-1)),ln=v(()=>t("br",null,null,-1)),nn=v(()=>t("br",null,null,-1)),on=v(()=>t("br",null,null,-1)),an=v(()=>t("br",null,null,-1)),sn=v(()=>t("br",null,null,-1)),un=v(()=>t("br",null,null,-1)),rn=v(()=>t("br",null,null,-1)),_n=v(()=>t("br",null,null,-1)),cn=v(()=>t("br",null,null,-1)),dn=v(()=>t("br",null,null,-1)),mn=v(()=>t("br",null,null,-1)),fn=v(()=>t("br",null,null,-1)),vn=v(()=>t("br",null,null,-1)),pn=v(()=>t("br",null,null,-1)),hn=v(()=>t("br",null,null,-1)),bn=v(()=>t("br",null,null,-1)),gn=v(()=>t("br",null,null,-1)),xn=v(()=>t("br",null,null,-1)),wn={__name:"AGV_ELE",setup(x){const r=y(!1),c=()=>{r.value=!0},p=()=>{j.value<Yt.value-1?j.value++:j.value=0,console.log(j.value),Ee.value="驱动轴"+j.value.toString(),z(),H()};return(g,m)=>{const o=Q,d=P;return F(),D(O,null,[E(h(o,{class:"EXButtonELE",onClick:c},{default:$(()=>[l("电器模块")]),_:1},512),[[I,!e(M)]]),h(d,{modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=b=>r.value=b),title:"电器模块","custom-class":"custom-dialog"},{default:$(()=>[l(" 保险杠状态："+n(e(Nt)),1),zl,l(" 急停触发："+n(e(Jt)),1),Hl,l(" pls状态："+n(e(qt)),1),Ql,Ul,l(" 二维码:"),Wl,l(" x:"+n(e(i)[e(a)].logJson.electricalModule.sensor.camera.fx.toFixed(4)),1),Zl,l(" y:"+n(e(i)[e(a)].logJson.electricalModule.sensor.camera.fy.toFixed(4)),1),Kl,l(" 角度:"+n(e(i)[e(a)].logJson.electricalModule.sensor.camera.fthita.toFixed(4)),1),en,tn,l(" 电量百分比："+n(e(i)[e(a)].logJson.electricalModule.sensor.battmetr.fCapPercent.toFixed(2)),1),ln,l(" 电池状态："+n(e(i)[e(a)].logJson.electricalModule.sensor.battmetr.sState),1),nn,on,l(" 磁导航偏差1:"+n(e(i)[e(a)].logJson.electricalModule.sensor.magnetic.fDev[0]),1),an,l(" 磁导航偏差2:"+n(e(i)[e(a)].logJson.electricalModule.sensor.magnetic.fDev[1]),1),sn,l(" 磁导航状态:"+n(e(i)[e(a)].logJson.electricalModule.sensor.magnetic.sGrade),1),un,rn,l(" 惯导："+n(),1),_n,l(" 切换驱动单元："),h(o,{class:"buttonstyle",onClick:p},{default:$(()=>[l(n(e(Ee)),1)]),_:1}),cn,l(" 轮伺服实际速度："+n(e(Ne)),1),dn,l(" 轮伺服状态码："+n(e(At)),1),mn,l(" 轮伺服错误码："+n(e(Ot)),1),fn,l(" 舵伺服实际位置："+n(e(Rt)),1),vn,l(" 舵伺服状态码："+n(e(Pt)),1),pn,l(" 舵伺服错误码："+n(e(Bt)),1),hn,l(" 舵限位开关："+n(e(Gt)),1),bn,l(" 舵限位开关："+n(e(Xt)),1),gn,l(" 舵零位开关："+n(e(jt)),1),xn,h(qe)]),_:1},8,["modelValue"])],64)}}},yn=Ve(wn,[["__scopeId","data-v-99fbd68b"]]);const $n=t("br",null,null,-1),Cn=t("br",null,null,-1),kn=t("br",null,null,-1),En={__name:"screen_info",setup(x,{expose:r}){const c=y(!1),p=y(!1);return r({handleMouseClick:m=>{const o=ne.intersectObjects([m]);o.length>0&&(console.log("modelname:",o[0].object.name),o[0].object.name==="screen"||o[0].object.name==="screen1"||o[0].object.name==="screen2"||o[0].object.name==="screen3"||o[0].object.name==="screen4"?(p.value=!0,c.value=!0):(c.value=!1,p.value=!1))}}),(m,o)=>{const d=P;return F(),D(O,null,[h(d,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),title:"屏幕2","custom-class":"custom-dialog2",onOpened:m.openDialog},{default:$(()=>[h(qe)]),_:1},8,["modelValue","onOpened"]),h(d,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=b=>c.value=b),title:"屏幕","custom-class":"custom-dialog3"},{default:$(()=>[l(" 屏幕型号:"+n(),1),$n,l(" 通讯类型:"+n(),1),Cn,l(" 手控设备信息:"+n(),1),kn]),_:1},8,["modelValue"])],64)}}},Mn=t("br",null,null,-1),Vn=t("br",null,null,-1),Sn=t("br",null,null,-1),In=t("br",null,null,-1),Tn=t("br",null,null,-1),Fn=t("br",null,null,-1),Dn=t("br",null,null,-1),Ln=t("br",null,null,-1),Nn=t("br",null,null,-1),Jn=t("br",null,null,-1),qn=t("br",null,null,-1),An=t("br",null,null,-1),On={__name:"wheel_info",setup(x,{expose:r}){const c=y(!1),p=y(!1);return r({handleMouseClickwheel:m=>{const o=ne.intersectObjects([m]);o.length>0&&(o[0].object.name==="rightwheel"||o[0].object.name==="rightwheel1"||o[0].object.name==="rightwheel2"?c.value=!0:c.value=!1,o[0].object.name==="leftwheel"||o[0].object.name==="leftwheel1"||o[0].object.name==="leftwheel2"?p.value=!0:p.value=!1)}}),(m,o)=>{const d=P;return F(),D(O,null,[h(d,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=b=>c.value=b),title:"右轮","custom-class":"custom-dialog3"},{default:$(()=>[l(" 驱动内坐标X:"+n(),1),Mn,l(" 驱动内坐标Y:"+n(),1),Vn,l(" 电机减速比:"+n(),1),Sn,l(" 车轮直径:"+n(),1),In,l(" 码盘线束:"+n(),1),Tn,l(" 最大转速:"+n(),1),Fn]),_:1},8,["modelValue"]),h(d,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=b=>p.value=b),title:"左轮","custom-class":"custom-dialog"},{default:$(()=>[l(" 驱动内坐标X:"+n(),1),Dn,l(" 驱动内坐标Y:"+n(),1),Ln,l(" 电机减速比:"+n(),1),Nn,l(" 车轮直径:"+n(),1),Jn,l(" 码盘线束:"+n(),1),qn,l(" 最大转速:"+n(),1),An]),_:1},8,["modelValue"])],64)}}};const Rn=x=>(Se("data-v-0e7a3644"),x=x(),Ie(),x),Pn={class:"home"},Bn={class:"choose"},Gn=Rn(()=>t("div",{class:"choose-title"},"控制：",-1)),Xn={class:"file-upload"},jn={class:"logprocess"},Yn=["disabled","max"],zn=["disabled","title"],Hn=["disabled","title"],Y=500,Qn={__name:"index",setup(x){y(0);const r=y(null),c=y(null),p=new ot,g=new at;g.setDecoderPath("https://asdqvqw.github.io/whwtest.github.io/draco/"),p.setDRACOLoader(g);const m=y(0),o=new G(16777215,1);o.position.set(0,0,10);const d=new G(16777215,1);d.position.set(0,0,-10);const b=new G(16777215,1);b.position.set(10,0,0);const _e=new G(16777215,1);_e.position.set(-10,0,0);const ce=new G(16777215,1);ce.position.set(0,10,0);let U,W,f,de=y(null),Ae=7;const oe=new Ze,V=new Ke,A=new et(75,window.innerWidth/window.innerHeight,.1,1e3);A.position.set(0,2,6);const Oe=s=>{const u=s.target.files[0],_=new FileReader;_.onload=C=>{const L=String(C.target.result);Re(L)},_.readAsText(u)},Re=s=>{K.success("开始导入数据...");const u=s.split("[INFO | ");for(let _=1;_<u.length;_++){const C=u[_],L=C.indexOf("]"),T=C.substring(0,L).trim(),B=C.substring(L+3).trim(),w=JSON.parse(B),N=w.navInfo.fRealX.toFixed(3),pe=w.navInfo.fRealY.toFixed(3),he=0,be=(w.navInfo.fRealThita*180/Math.PI).toFixed(3),ge=w.equipmentInfo.rack.turn_axis.fAxisPosition/1e3,xe=w.equipmentInfo.rack.lifter_axis.fAxisPosition,we=w.uAgvType;i.value.push({logDateTime:T,logJson:w,realx:N,realy:pe,realthita:be,realz:he,trunpan:ge,lifter:xe,agvType:we}),Te.push({logDateTime:T,logJson:w,realx:N,realy:pe,realthita:be,realz:he,trunpan:ge,lifter:xe,agvType:we})}K.success("开始导入模型..."),zt.parsedLogData_b=i.value,m.value=i.value.length-1,i.value[0].agvType===0?(p.load("./main/test.glb",_=>{f=_.scene,f.position.set(0,0,0),f.scale.set(1,.6,.7),f.rotation.set(0,X.degToRad(90),0),V.add(f),me(),fe(),ve()},_=>{console.log(_.loaded/_.total*100+"% loaded")},_=>{console.error("Error loading model:",_)}),K.success("导入完成")):K.error("没有匹配模型"),M.value=!1,Pe()},Pe=()=>{const s=new $e({color:255,linewidth:1}),u=i.value.map(N=>new J(N.realx,N.realz,-N.realy)),_=new Ce().setFromPoints(u);let C=new ke(_,s);const L=new $e({color:16711680,linewidth:1}),T=i.value.map(N=>new J(N.logJson.tcInfo.iDevX/1e3,0,-N.logJson.tcInfo.iDevY/1e3)),B=new Ce().setFromPoints(T);let w=new ke(B,L);a.value=0,V.add(C),V.add(w),se()},Be=()=>{if(f&&a.value>0){a.value--;const s=i.value[a.value];f.position.set(s.realx,0,-s.realy);const u=new ee(0,X.degToRad(i.value[a.value-1].realthita),0,"XYZ"),_=new te().setFromEuler(u);f.setRotationFromQuaternion(_),z(),H()}},Ge=()=>{if(f&&k.value&&a.value>0){a.value--;const s=i.value[a.value];f.position.set(s.realx,0,-s.realy);const u=new ee(0,X.degToRad(i.value[a.value-1].realthita),0,"XYZ"),_=new te().setFromEuler(u);f.setRotationFromQuaternion(_),z(),H()}},Xe=()=>{if(f&&k.value&&a.value<i.value.length-1){a.value++;const s=i.value[a.value];f.position.set(s.realx,0,-s.realy);const u=new ee(0,X.degToRad(i.value[a.value+1].realthita),0,"XYZ"),_=new te().setFromEuler(u);f.setRotationFromQuaternion(_),z(),H()}},je=s=>{oe.x=s.clientX/window.innerWidth*2-1,oe.y=-(s.clientY/window.innerHeight)*2+1,ne.setFromCamera(oe,A),f!==void 0&&(ne.intersectObjects([f]).length>0?(De.value=s.clientX+10,Le.value=s.clientY+10,le.value=!0):le.value=!1)},Ye=()=>{le.value=!1},Z=new tt({antialias:!0});Z.setSize(window.innerWidth,window.innerHeight);const ze=()=>{if(f&&!k.value&&!S.value&&i.value[a.value]&&i.value[a.value+1]){a.value++;const s=i.value[a.value];f.position.set(s.realx,0,-s.realy);const u=new ee(0,X.degToRad(i.value[a.value].realthita),0,"XYZ"),_=new te().setFromEuler(u);f.setRotationFromQuaternion(_),z(),H(),i.value[a.value].logJson.nAgvState===3&&i.value[a.value].logJson.event.name!==""&&(re.value=2,S.value=!0)}};let ae=0;const se=()=>{ae++,ae>=Ae&&(ze(),ae=0),R.value&&f&&(A.position.copy(f.position),A.position.y+=6,A.lookAt(f.position)),Z.render(V,A),U&&U.update(),requestAnimationFrame(se)},me=()=>{f.traverse(s=>{if(s.name==="upDown"&&(s.rotation.y=i.value[a.value].trunpan.toFixed(2),s.position.y=i.value[a.value].lifter+1e3),s.name==="leftwheel"&&(s.rotation.z+=i.value[a.value].logJson.electricalModule.kinematic.drive[0].wheel.fServoSpeed.toFixed(5)*.5),s.name==="rightwheel"&&(s.rotation.z+=i.value[a.value].logJson.electricalModule.kinematic.drive[1].wheel.fServoSpeed.toFixed(5)*.5),s.name==="rightwheel"&&(s.rotation.z+=i.value[a.value].logJson.electricalModule.kinematic.drive[1].wheel.fServoSpeed.toFixed(5)*.5),s.name==="turnnei")if(i.value[a.value].logJson.equipmentInfo.rack.turn_axis.bLevel){const u=new q({color:16711680});s.material=u}else{const u=new q({color:65280});s.material=u}if(s.name==="turnwai")if(i.value[a.value].logJson.equipmentInfo.rack.turn_axis.bZero){const u=new q({color:16711680});s.material=u}else{const u=new q({color:65280});s.material=u}if(s.name==="liftertop")if(i.value[a.value].logJson.equipmentInfo.rack.lifter_axis.bTop){const u=new q({color:16711680});s.material=u}else{const u=new q({color:65280});s.material=u}if(s.name==="lifterbuttom")if(i.value[a.value].logJson.equipmentInfo.rack.lifter_axis.bBottom){const u=new q({color:16711680});s.material=u}else{const u=new q({color:65280});s.material=u}}),requestAnimationFrame(me)},fe=()=>{f.traverse(s=>{if(s.name==="screen2"){const u=Math.random()*16777215;s.material.color.setHex(u)}}),setTimeout(fe,200)};let ie=1;const ve=()=>{const u={1:{on:65280,off:16777215},2:{on:16711680,off:16777215}}[re.value],_=u.on,C=u.off,L=(T,B)=>{T.traverse(w=>{w instanceof nt&&(w.material.color.clone(),w.material.color.set(B))})};f.traverse(T=>{T.name==="light"&&(ie===1?L(T,_):L(T,C))}),ie=1-ie,setTimeout(ve,500)};return Me(()=>{window.addEventListener("mousemove",je),window.addEventListener("mouseout",Ye),window.addEventListener("click",()=>{r.value.handleMouseClick(f)}),window.addEventListener("click",()=>{c.value.handleMouseClickwheel(f)}),de.value.appendChild(Z.domElement),W=new lt(Y,Y),W.material.opacity=.3,W.material.transparent=!0,V.add(W);const s=new ue(new J(1,0,0),new J(0,0,0),Y/2,16711680),u=new ue(new J(0,0,0),new J(0,0,0),Y/2,65280),_=new ue(new J(0,0,-1),new J(0,0,0),Y/2,255);V.add(s,u,_),U=new st(A,Z.domElement),U.update(),V.add(o),V.add(d),V.add(b),V.add(_e),V.add(ce),se()}),(s,u)=>{const _=Q;return F(),D("div",Pn,[t("div",{class:"canvas-container",ref_key:"canvasDom",ref:de},null,512),t("div",Bn,[Gn,E(t("div",Xn,[t("input",{ref:"importInput",type:"file",accept:".log",style:{display:"none"},onChange:Oe},null,544),h(_,{onClick:u[0]||(u[0]=C=>s.$refs.importInput.click()),class:"buttonstyle"},{default:$(()=>[l(" 导入 ")]),_:1})],512),[[I,e(M)]]),E(t("div",jn,[l(" 回放进度:"+n(e(S)?"请处理事件":e(i)[e(a)]===void 0?"":e(i)[e(a)].logDateTime)+" ",1),E(t("input",{disabled:e(S),type:"range",style:{width:"100%"},"onUpdate:modelValue":u[1]||(u[1]=C=>Ue(a)?a.value=C:null),min:"0",max:m.value,step:"1",onChange:Be},null,40,Yn),[[We,e(a)]])],512),[[I,!e(M)]]),h(Wt),E(t("div",null,[t("button",{disabled:!e(k)||e(a)===e(i).length+1,onClick:Ge,class:"next2playbuttonstyle",title:e(k)?"上一步":"请暂停"},null,8,zn),t("button",{disabled:!e(k)||e(a)===e(i).length-1,onClick:Xe,class:"nextplaybuttonstyle",title:e(k)?"下一步":"请暂停"},null,8,Hn)],512),[[I,!e(M)]]),h(xl)]),h(Nl),h(yn),h(Yl),h(En,{ref_key:"screenRef",ref:r},null,512),h(On,{ref_key:"wheelRef",ref:c},null,512),h(cl)])}}},lo=Ve(Qn,[["__scopeId","data-v-0e7a3644"]]);export{lo as default};
