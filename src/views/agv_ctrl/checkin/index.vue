<template>
  <div class="page-container main-view">
    <div class="table-box content-container page-content-box"
      style="background-image: linear-gradient(to bottom right, #d0dcdc95, #d5eedf17)">
      <div>
        <h2 style="margin-top: 1%; margin-left: 1%;">âš ï¸è¾“å…¥ç‚¹ï¼š</h2>
        <div class="hengxian"></div>


        <div class="box">

          <h3>æµ‹è¯•è¾“å…¥ç‚¹å®Œæ¯•ä¸€å®šè¦é€€å‡ºâš ï¸
            å¦åˆ™è½¦ä½“ç¨‹åºæ— æ³•è½¯å¯åŠ¨ï¼ï¼</h3>

          <div class="hengxian"></div>
          <br><br>
          <el-button type="success" style="margin-top: 2%;  width: 90%;" @click="Checkiobegin">ğŸˆæŸ¥çœ‹</el-button>
          <br><br><br><br>

        </div>

        <el-dialog v-model="checkiobegin" title="è¾“å…¥ç‚¹" width="900px" height="500px" :show-close=false
          :close-on-click-modal="false">
          <h3>'ğŸ”´' ä¸ºæœ‰è¾“å…¥, 'ğŸŸ¢'ä¸ºæ— è¾“å…¥</h3>
          <el-table :data="tableData" border class="datatableinpoint">
            <el-table-column prop="key" label="è¾“å…¥ç‚¹"></el-table-column>
            <el-table-column prop="value"></el-table-column>
            <el-table-column prop="key2"></el-table-column>
            <el-table-column prop="value2"></el-table-column>
            <el-table-column prop="key3"></el-table-column>
            <el-table-column prop="value3"></el-table-column>
          </el-table>
          <br>
          <div style="width: 100%; margin-left: -10%;
                  display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5%;">
            <br>
            <el-button type="primary" style=" width: 70%; margin-left: 15%;">è®°å½•ä¸‹è½½</el-button>

            <el-button @click="Checkioend" type="primary" style=" width: 70%; margin-left: 15%;">é€€ å‡º</el-button>
          </div>
          <br>
        </el-dialog>


      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
const checkiobegin = ref(false);
const dataArray = ref([]);
import axios from "axios";

const tableData = computed(() => {

  return [
    {
      key: 'è¾“å…¥ç‚¹0', value: dataArray.value[23] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹1', value2: dataArray.value[22] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹2', value3: dataArray.value[21] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹3', value: dataArray.value[20] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹4', value2: dataArray.value[19] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹5', value3: dataArray.value[18] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹6', value: dataArray.value[17] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹7', value2: dataArray.value[16] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹8', value3: dataArray.value[15] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹9', value: dataArray.value[14] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹10', value2: dataArray.value[13] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹11', value3: dataArray.value[12] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹12', value: dataArray.value[11] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹13', value2: dataArray.value[10] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹14', value3: dataArray.value[9] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹15', value: dataArray.value[8] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹16', value2: dataArray.value[7] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹17', value3: dataArray.value[6] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹18', value: dataArray.value[5] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹19', value2: dataArray.value[4] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹20', value3: dataArray.value[3] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
    {
      key: 'è¾“å…¥ç‚¹21', value: dataArray.value[2] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key2: 'è¾“å…¥ç‚¹22', value2: dataArray.value[1] == 1 ? 'ğŸ”´' : 'ğŸŸ¢',
      key3: 'è¾“å…¥ç‚¹23', value3: dataArray.value[0] == 1 ? 'ğŸ”´' : 'ğŸŸ¢'
    },
  ]
});


const Checkiobegin = () => {

  var userList = {
    type: 'checkin',
    data: true
  }
  console.log(JSON.stringify(userList));
  axios({
    method: 'post',
    url: '/api/ctrl/manualdata',
    data: JSON.stringify(userList),
  }).then((res) => {

    checkiobegin.value = true;
  }).catch(error => {
    // ElMessage.error('è¯·æ±‚å¤±è´¥')
  }).finally(() => {
  })
  syncAgvParm();
  checkiobegin.value = true;
}

const Checkioend = () => {
  var userList = {
    type: 'checkinend',
    data: true
  }
  console.log(JSON.stringify(userList));
  axios({
    method: 'post',
    url: '/api/ctrl/manualdata',
    data: JSON.stringify(userList),
  }).then((res) => {
    checkiobegin.value = false;
  }).catch(error => {
    // ElMessage.error('è¯·æ±‚å¤±è´¥')
  }).finally(() => {
  })
  clearTimeout(timer_ioin.value);
  checkiobegin.value = false;
}

const timer_ioin = ref(null);
const response = ref('null');
const syncAgvParm = () => {
  let userList = {
    data: 'outputio.txt',
    group: 'siasun',
    account: 'test',
    password: '123456'
  }

  axios({
    method: 'post',
    url: '/api/data/jsoneditor',
    data: JSON.stringify(userList)
  })
    .then((res) => {

      response.value = res.data

      const rawData = res.data.replace(/\s/g, '');

      dataArray.value = rawData.split('').map(item => (item === '.' ? 0 : 1))

      // ç¡®ä¿æ•°ç»„é•¿åº¦ä¸º 24 ä¸ªå…ƒç´ 
      while (dataArray.value.length < 24) {
        dataArray.value.unshift(0)
      }
    })
    .catch((error) => {
      // ElMessage.error('è¯·æ±‚å¤±è´¥')
    })
    .finally(() => {
      // å¯ä»¥åœ¨æ­¤å¤„æ‰§è¡Œå…¶ä»–æ“ä½œ
    })

  timer_ioin.value = setTimeout(syncAgvParm, 1000);
}



</script>


<style scoped>
.hengxian {
  border: none;
  border-top: 2px solid #ccc;
  margin: 20px 0;
}

.box {
  border: 5px double #8d8a8a;
  box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);
  padding: 20px;
  text-align: center;
  width: 80%;
  height: 100%;
  margin: 0 auto;
  background-image: linear-gradient(to bottom right, #f0f8ff95, #f5ffe0cc);
}
</style>

<style scoped>
.input-points {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}

.input-point {
  display: inline-block;
  width: 30px;
  height: 30px;
  background-color: #ccc;
  margin: 4px;
  text-align: center;
  line-height: 30px;
  border-radius: 4px;
}

.input-point.active {
  background-color: #0077b6;
  color: #fff;
}

.datatableinpoint {
  width: 90%;
  margin-left: 5%;
  margin-top: 2%;

}
</style>

<style>
.datatableinpoint .el-table__body tr:nth-child(2n) {
  background-color: #768aaa67;
  /* éš”è¡ŒèƒŒæ™¯è‰² */
}
</style>